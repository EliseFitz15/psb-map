<div class="route-content">
  <div class="route-list-description">
    <p>
      Please select a route to find bus stops that need clues.
    </p>
  </div>
  <div class="route-selector-container">
    <select class="route-select" onchange="selectRoute(this.value)">
      <option value="">Choose Route</option>
    </select>
  </div>
</div>

<div class="stops-list-container">
  <div class='list-spinner'></div>
  <ul class="stops-list"></ul>
</div>

<script>
function setHeader(xhr) {
  xhr.setRequestHeader('Authorization', 'Token 54fdca8993c763119379479b02c87bda23683f1c');
}

function selectRoute(selected) {
  $(".stops-list").empty();
  $(".stops-list-container p").remove();
  $(".list-spinner").addClass("spinning")

  var request = $.ajax({
    url: "https://api.blindways.org/agencies/1/routes/" + selected + "/stops",
    type: 'GET',
    crossDomain: true,
    success: function(response) {
      $(".list-spinner").removeClass("spinning");
      if (response.length > 0) {
        $(".stops-list-container").prepend("<p>The following <span>" + response.length + "</span> stops on this route still need clues:</p>");

        response.forEach(function(stop) {
          $(".stops-list").append("<li>" + stop["name"] + "</li>");
        });
      } else {
        $(".stops-list-container").prepend("<p>Thank you to all our crowdsourcers this bus route doesn't have any bus stops that require clues!</p>");
      };
    },
    beforeSend: setHeader
  });
}

var request = $.ajax({
  url: "https://api.blindways.org/agencies/1/routes?include_details=0",
  type: 'GET',
  crossDomain: true,
  success: function(response) {
    response.forEach(function(stop){
      $(".route-select").append("<option value=" + "\"" + stop["id"] + "\">" + stop["name"] + "</option>");
    });
  },
  beforeSend: setHeader
});
</script>
